[MySQL数据库教程天花板，mysql安装到mysql高级，强！硬！_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1iq4y1u7vj/?spm_id_from=333.337.search-card.all.click&vd_source=339a4744bd362ae7b381fd9629bfd3a9)


# 03 基本的SELECT语句 p12
![[Pasted image 20230206202151.png]]

### 语法规则和规范
1) 基本规则
* SQL 可以写在一行或者多行。为了提高可读性，各子句分行写，必要时使用缩进 
* 每条命令以 ; 或 \g 或 \G 结束 
* 关键字不能被缩写也不能分行 
* 关于标点符号 
  * 必须保证所有的()、单引号、双引号是成对结束的 
  * 必须使用英文状态下的半角输入方式 
  * 字符串型和日期时间类型的数据可以使用单引号（' '）表示 
  * 列的别名，尽量使用双引号（" "），而且不建议省略as
  
2) SQL大小写规范（建议遵守）
* MySQL 在 Windows 环境下是大小写不敏感的 
* MySQL 在 Linux 环境下是大小写敏感的 
  * 数据库名、表名、表的别名、变量名是严格区分大小写的 
  * 关键字、函数名、列名(或字段名)、列的别名(字段的别名) 是忽略大小写的。 
* 推荐采用统一的书写规范： 
  * 数据库名、表名、表别名、字段名、字段别名等都小写 
  * SQL 关键字、函数名、绑定变量等都大写

```mysql
单行注释：#注释文字(MySQL特有的方式)
单行注释：-- 注释文字(--后面必须包含一个空格。)
多行注释：/* 注释文字 */
```

4) 命名规则
* 数据库、表名不得超过30个字符，变量名限制为29个 
* 必须只能包含 A–Z, a–z, 0–9, _共63个字符 
* 数据库名、表名、字段名等对象名中间不要包含空格 同一个MySQL软件中，数据库不能同名；同一个库中，表不能重名；
* 同一个表中，字段不能重名 必须保证你的字段没有和保留字、数据库系统或常用方法冲突。如果坚持使用，请在SQL语句中使 用`（着重号）引起来 
* 保持字段名和类型的一致性，在命名字段并为其指定数据类型的时候一定要保证一致性。假如数据 类型在一个表里是整数，那在另一个表里可就别变成字符型了

## 导入现有表
```mysql
source 路径
```

## 基本的SELECT语句
```mysql
SELECT 标识选择哪些列
FROM 标识从哪个表中选择

# *选择全部列
SELECT *
FROM departments;

SELECT department_id, location_id
FROM departments;

# 重命名一个列
# 在列名和别名之间加入关键字AS（AS可以省略）或者使用""
 AS 可以省略 
* 建议别名简短，见名知意
SELECT last_name AS name, commission_pct comm, usrid "name"
FROM employees;

# 去重DISTINCT
SELECT DISTINCT department_id
FROM   employees;

# 空值null参与运算
# 空值不等于空字符串
# 这里commission_pct可能为null
SELECT employee_id,salary,commission_pct,
12 * salary * (1 + IFNULL(commission_pct,0)) "年工作"
FROM employees;

# 着重号
# 必须保证你的字段没有和保留字、数据库系统或常见方法冲突。
# 如果坚持使用，在SQL语句中使用 \` \` 引起来。
mysql
SELECT * FROM `order`

# 查询常数

# 显示表结构
DESCRIBE employees;
或
DESC employees;
```

## 显示表结构
```mysql
# 显示表结构
DESCRIBE employees;
或
DESC employees;
```

## where过滤数据
使用WHERE 子句，将不满足条件的行过滤掉。WHERE子句紧随 FROM子句。
```mysql
SELECT employee_id, last_name, job_id, department_id
FROM employees
WHERE department_id = 90;
```

# 04 运算符
### 算术运算符
```mysql
mysql> SELECT 100, 100 + 0, 100 - 0, 100 + 50, 100 + 50 -30, 100 + 35.5, 100 - 35.5 FROM dual;
+-----+---------+---------+----------+--------------+------------+------------+
| 100 | 100 + 0 | 100 - 0 | 100 + 50 | 100 + 50 -30 | 100 + 35.5 | 100 - 35.5 |
+-----+---------+---------+----------+--------------+------------+------------+
| 100 |     100 |     100 |      150 |          120 |      135.5 |       64.5 |
+-----+---------+---------+----------+--------------+------------+------------+
1 row in set (0.00 sec)
```
> - 一个整数类型的值对整数进行加法和减法操作，结果还是一个整数；
> - 一个整数类型的值对浮点数进行加法和减法操作，结果是一个浮点数；
> - 加法和减法的优先级相同，进行先加后减操作与进行先减后加操作的结果是一样的；
> - 在Java中，+的左右两边如果有字符串，那么表示字符串的拼接。但是在MySQL中+只表示数值相加。如果遇到非数值类型，先尝试转成数值，如果转失败，就按0计算。（补充：MySQL中字符串拼接要使用字符串函数CONCAT()实现）


## 比较运算符
1) 等号运算符 =
	比较的结果为真则返回1，比较的结果 为假则返回0，其他情况则返回NULL
	如果等号两边的值、字符串或表达式中有一个为NULL，则比较结果为NULL
	如果等号两边的值、字符串或表达式都为字符串，则MySQL会按照字符串进行比较，其比较的 是每个字符串中字符的ANSI编码是否相等。 
	如果等号两边的值都是整数，则MySQL会按照整数来比较两个值的大小。 
	如果等号两边的值一个是整数，另一个是字符串，则MySQL会将字符串转化为数字进行比较。 
	如果等号两边的值、字符串或表达式中有一个为NULL，则比较结果为NULL。
2) 安全等于 <=>
	安全等于运算符（<=>）与等于运算符（=）的作用是相似的，`唯一的区别`是‘<=>’可以用来对NULL进行判断。在两个操作数均为NULL时，其返回值为1，而不为NULL；当一个操作数为NULL时，其返回值为0，而不为NULL
3) 不等于 <>和!=
4) 非符号类型运算符
![[Pasted image 20230206202209.png]]
5）空运算符
	空运算符 (IS NULL 或者 ISNULL) 判断一个值是否为NULL，如果为NULL则返回1，否则返回0。
```mysql
mysql> SELECT NULL IS NULL, ISNULL(NULL)
```
6）最小值运算符
	语法格式为：LEAST(值1，值2，...，值n)。其中，“值n”表示参数列表中有n个值。在有 两个或多个参数的情况下，返回最小值。
	由结果可以看到，当参数是整数或者浮点数时，LEAST将返回其中最小的值；当参数为字符串时，返回字 母表中顺序最靠前的字符；当比较值列表中有NULL时，不能判断大小，返回值为NULL
```mysql
mysql> SELECT LEAST (1,0,2), LEAST('b','a','c'), LEAST(1,NULL,2);
+---------------+--------------------+-----------------+
| LEAST (1,0,2) | LEAST('b','a','c') | LEAST(1,NULL,2) |
+---------------+--------------------+-----------------+
|       0       |          a         |        NULL     |
+---------------+--------------------+-----------------+
```
7）最大值运算符
	语法格式为：GREATEST(值1，值2，...，值n)。其中，n表示参数列表中有n个值。当有 两个或多个参数时，返回值为最大值。假如任意一个自变量为NULL，则GREATEST()的返回值为NULL
	由结果可以看到，当参数中是整数或者浮点数时，GREATEST将返回其中最大的值；当参数为字符串时， 返回字母表中顺序最靠后的字符；当比较值列表中有NULL时，不能判断大小，返回值为NULL。
```mysql
mysql> SELECT GREATEST(1,0,2), GREATEST('b','a','c'), GREATEST(1,NULL,2);
+-----------------+-----------------------+--------------------+
| GREATEST(1,0,2) | GREATEST('b','a','c') | GREATEST(1,NULL,2) |
+-----------------+-----------------------+--------------------+
|         2       |             c         |         NULL       |
+-----------------+-----------------------+--------------------+
```
8) BETWEEN AND运算符
	BETWEEN运算符使用的格式通常为SELECT D FROM TABLE WHERE C BETWEEN A AND B，此时，当C大于或等于A，并且C小于或等于B时，结果为1，否则结果为0。
9) IN运算符
	IN运算符用于判断给定的值是否是IN列表中的一个值，如果是则返回1，否则返回0。如果给 定的值为NULL，或者IN列表中存在NULL，则结果为NULL
```mysql
mysql> SELECT 'a' IN ('a','b','c'), 1 IN (2,3), NULL IN ('a','b'), 'a' IN ('a', NULL);
+----------------------+------------+-------------------+--------------------+
| 'a' IN ('a','b','c') | 1 IN (2,3) | NULL IN ('a','b') | 'a' IN ('a', NULL) |
+----------------------+------------+-------------------+--------------------+
|            1         |      0     |         NULL      |          1         |
+----------------------+------------+-------------------+--------------------+
```
9) NOT IN运算符
	NOT IN运算符用于判断给定的值是否不是IN列表中的一个值，如果不是IN列表中的一 个值，则返回1，否则返回0。
10) LIKE运算符
	LIKE运算符主要用来匹配字符串，通常用于模糊匹配，如果满足条件则返回1，否则返回 0。如果给定的值或者匹配条件为NULL，则返回结果为NULL。
```mysql
“%”：匹配0个或多个字符。
“_”：只能匹配一个字符。
```
11) ESCAPE
	 回避特殊符号的：使用转义符。例如：将[%]转为[$%]、[]转[$]，然后再加上[ESCAPE‘$’]即可

## 逻辑运算符


## 位运算符


## 运算符的优先级


## 使用正则表达式查询


# 05 排序与分页

## 1. 排序数据
如果没有使用排序操作，默认情况下查询返回的数据是按照添加数据数据的顺序显示

### 1.1 排序规则
-   使用 ORDER BY 子句排序
    -   **ASC（ascend）: 升序**
    -   **DESC（descend）:降序**
-   ORDER BY 子句在SELECT语句的结尾。

### 1.2 单列排序
```mysql
# 如果在ORDER BY后面没有显示指定排序的方式则默认按照升序排列
# 并且可以使用列的别名进行排序，但是类的别名只能在order by中使用不能再where中使用
# 因为sql执行的顺序是from where select order by，where使用别名时还没有创建别名
# where需要声明在from后面order by前面
SELECT   last_name, job_id, department_id, hire_date  
FROM     employees  
ORDER BY hire_date ;
```

### 1.3 多列排序
```
SELECT last_name, department_id, salary  
FROM   employees  
ORDER BY department_id, salary DESC;
```
-   可以使用不在SELECT列表中的列排序。
-   在对多列进行排序的时候，首先排序的第一列必须有相同的列值，才会对第二列进行排序。如果第一列数据中所有值都是唯一的，将不再对第二列进行排序。

## 2. 分页

### 2.1 背景
- 背景1：查询返回的记录太多了，查看起来很不方便，怎么样能够实现分页查询呢？
- 背景2：表里有 4 条数据，我们只想要显示第 2、3 条数据怎么办呢？

### 2.2 实现规则
-   分页原理
    所谓分页显示，就是将数据库中的结果集，一段一段显示出来需要的条件。
-   **MySQL中使用 LIMIT 实现分页**
-   格式：
```mysql
LIMIT [位置偏移量,] 行数
```
    第一个“位置偏移量”参数指示MySQL从哪一行开始显示，是一个可选参数，如果不指定“位置偏移   量”，将会从表中的第一条记录开始；第二个参数“行数”指示返回的记录条数。
-   举例
```
--前10条记录：  
SELECT * FROM 表名 LIMIT 0,10;  
或者  
SELECT * FROM 表名 LIMIT 10;  
​  
--第11至20条记录：  
SELECT * FROM 表名 LIMIT 10,10;  
​  
--第21至30条记录：   
SELECT * FROM 表名 LIMIT 20,10;
```

> MySQL 8.0中可以使用“LIMIT 3 OFFSET 4”，意思是获取从第5条记录开始后面的3条记录，和“LIMIT 4,3;”返回的结果相同。
-   分页显式公式：（当前页数-1）* 每页条数，每页条数
```
SELECT * FROM table   
LIMIT(PageNo - 1)*PageSize,PageSize;
```
-   **注意：LIMIT 子句必须放在整个SELECT语句的最后！**

### 2.3 拓展
在不同的 DBMS 中使用的关键字可能不同。在 MySQL、PostgreSQL、MariaDB 和 SQLite 中使用 LIMIT 关键字，而且需要放到 SELECT 语句的最后面。


# MySql架构篇



# 索引及调优篇



# 事务篇 161-
## 13 事务的基础知识 161-
### 基本概念
**事务：一组逻辑操作单元，使数据从一种状态变换到另一种状态。
**事务处理的原则：保证所有事务都作为 `一个工作单元` 来执行，即使出现了故障，都不能改变这种执行方 式。当在一个事务中执行多个操作时，要么所有的事务都被提交( `commit` )，那么这些修改就 `永久` 地保 `存下来`；要么数据库管理系统将 `放弃` 所作的所有 `修改` ，整个事务回滚( rollback )到最初状态。

### 事务的ACID特性
**原子性（atomicity）：**
原子性是指事务是一个不可分割的工作单位，要么全部提交，要么全部失败回滚。即要么转账成功，要么转账失败，是不存在中间的状态。如果无法保证原子性会怎么样？就会出现数据不一致的情形，A账户减去100元，而B账户增加100元操作失败，系统将无故丢失100元。

**一致性（consistency）：**
（国内很多网站上对一致性的阐述有误，具体可以参考 Wikipedia 对Consistency的阐述）
根据定义，一致性是指事务执行前后，数据从一个 `合法性状态` 变换到另外一个 `合法性状态` 。这种状态是 `语义上` 的而不是语法上的，跟具体的业务有关。
那什么是合法的数据状态呢？满足 `预定的约束` 的状态就叫做合法的状态。通俗一点，这状态是由你自己来定义的（比如满足现实世界中的约束）。满足这个状态，数据就是一致的，不满足这个状态，数据就 是不一致的！如果事务中的某个操作失败了，系统就会自动撤销当前正在执行的事务，返回到事务操作 之前的状态。
**举例1：**A账户有200元，转账300元出去，此时A账户余额为-100元。你自然就发现此时数据是不一致的，为什么呢？因为你定义了一个状态，余额这列必须>=0。
**举例2：**A账户有200元，转账50元给B账户，A账户的钱扣了，但是B账户因为各种意外，余额并没有增加。你也知道此时的数据是不一致的，为什么呢？因为你定义了一个状态，要求A+B的总余额必须不变。
**举例3：**在数据表中我们将`姓名`字段设置为`唯一性约束`，这时当事务进行提交或者事务发生回滚的时候，如果数据表的姓名不唯一，就破坏了事物的一致性要求。

**隔离型（isolation）：**
事务的隔离性是指一个事务的执行`不能被其他事务干扰`，即一个事务内部的操作及使用的数据对`并发`的其他事务是隔离的，并发执行的各个事务之间不能相互干扰。

如果无法保证隔离性会怎么样？假设A账户有200元，B账户0元。A账户往B账户转账两次，每次金额为50 元，分别在两个事务中执行。如果无法保证隔离性，会出现下面的情形：
```mysql
UPDATE accounts SET money = money - 50 WHERE NAME = 'AA';
UPDATE accounts SET money = money + 50 WHERE NAME = 'BB';
```

**持久性（durability）：**
持久性是指一个事务一旦被提交，它对数据库中数据的改变就是 永久性的 ，接下来的其他操作和数据库 故障不应该对其有任何影响。

持久性是通过 `事务日志` 来保证的。日志包括了 `重做日志` 和 `回滚日志` 。当我们通过事务对数据进行修改 的时候，首先会将数据库的变化信息记录到重做日志中，然后再对数据库中对应的行进行修改。这样做 的好处是，即使数据库系统崩溃，数据库重启后也能找到没有更新到数据库系统中的重做日志，重新执 行，从而使事务具有持久性。
> 总结
>
> ACID是事务的四大特征，在这四个特性中，原子性是基础，隔离性是手段，一致性是约束条件， 而持久性是我们的目的。
>
> 数据库事务，其实就是数据库设计者为了方便起见，把需要保证`原子性`、`隔离性`、`一致性`和`持久性`的一个或多个数据库操作称为一个事务。


### 事务的状态
我们现在知道 `事务` 是一个抽象的概念，它其实对应着一个或多个数据库操作，MySQL根据这些操作所执 行的不同阶段把 `事务` 大致划分成几个状态：
* **活动的（active）**
  事务对应的数据库操作正在执行过程中时，我们就说该事务处在 `活动的` 状态。
* **部分提交的（partially committed）**
  当事务中的最后一个操作执行完成，但由于操作都在内存中执行，所造成的影响并 `没有刷新到磁盘` 时，我们就说该事务处在 `部分提交的` 状态。
* **失败的（failed）**
  当事务处在 `活动的` 或者 部分提交的 状态时，可能遇到了某些错误（数据库自身的错误、操作系统 错误或者直接断电等）而无法继续执行，或者人为的停止当前事务的执行，我们就说该事务处在 失 败的 状态。
* **中止的（aborted）**
  如果事务执行了一部分而变为 `失败的` 状态，那么就需要把已经修改的事务中的操作还原到事务执 行前的状态。换句话说，就是要撤销失败事务对当前数据库造成的影响。我们把这个撤销的过程称之为 `回滚` 。当 `回滚` 操作执行完毕时，也就是数据库恢复到了执行事务之前的状态，我们就说该事 务处在了 `中止的` 状态。
  举例：
  ```mysql
  UPDATE accounts SET money = money - 50 WHERE NAME = 'AA';
  
  UPDATE accounts SET money = money + 50 WHERE NAME = 'BB';
  ```
* **提交的（committed）**
  当一个处在 `部分提交的` 状态的事务将修改过的数据都 `同步到磁盘` 上之后，我们就可以说该事务处在了 `提交的` 状态。

  一个基本的状态转换图如下所示：
![[Pasted image 20230206202226.png]]
  图中可见，只有当事物处于`提交的`或者`中止的`状态时，一个事务的生命周期才算是结束了。对于已经提交的事务来说，该事务对数据库所做的修改将永久生效，对于处于中止状态的事物，该事务对数据库所做的所有修改都会被回滚到没执行该事物之前的状态。




 




# 日志与备份篇
